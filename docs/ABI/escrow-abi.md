# 📘 راهنمای ABI برای قرارداد Escrow (escrow\.fc)

این سند رابط‌های عمومی قرارداد اسکرو را برای استفاده DAppها، DAO و قراردادهای دیگر توضیح می‌دهد.

---

## 🔹 1. مقداردهی اولیه (init)

* **نوع:** `()`
* **عملکرد:**

  * ذخیره آدرس فراخواننده (`deployer`) به‌عنوان `governance_address`
* **پارامترها:** ندارد
* **خروجی:** `()`

---

## 🔹 2. تعیین آدرس قرارداد توکن KYT

* **نام تابع:** `set_token_address`
* **نوع:** تابع خارجی
* **پارامترها:**

  * `new_token: slice` ⟶ آدرس قرارداد توکن
* **محدودیت:** فقط توسط `governance_address`

---

## 🔹 3. تغییر آدرس حاکم (DAO)

* **نام تابع:** `set_governance`
* **نوع:** تابع خارجی
* **پارامترها:**

  * `new_gov: slice` ⟶ آدرس حاکم جدید (DAO)
* **محدودیت:** فقط توسط `governance_address`

---

## 🔹 4. شروع تراکنش اسکرو (initiate)

* **نوع:** تابع خارجی
* **نام تابع:** `initiate`
* **پارامترها:**

  * `receiver: slice` ⟶ آدرس راننده
  * `amount: int` ⟶ مقدار توکن KYT که باید قفل شود
* **عملکرد:**

  * ایجاد تراکنش جدید با وضعیت `PENDING`
  * انتقال توکن از کاربر به قرارداد اسکرو از طریق `call` به توکن
* **محدودیت:** نیازمند موجودی کافی

---

## 🔹 5. تأیید تحویل کالا (confirm)

* **نوع:** تابع خارجی
* **نام تابع:** `confirm`
* **پارامترها:**

  * `tx_id: int` ⟶ شناسه تراکنش
* **عملکرد:**

  * اگر فراخواننده، همان صاحب بار باشد، انتقال توکن به راننده انجام می‌شود
  * وضعیت تراکنش به `COMPLETED` تغییر می‌کند
* **محدودیت:** فقط فرستنده اصلی تراکنش می‌تواند تأیید کند

---

## 🔹 6. بازپرداخت وجه (refund)

* **نوع:** تابع خارجی
* **نام تابع:** `refund`
* **پارامترها:**

  * `tx_id: int` ⟶ شناسه تراکنش
* **عملکرد:**

  * بازگرداندن مبلغ توکن به صاحب بار در صورت نیاز
  * فقط توسط `governance_address` انجام‌پذیر است
  * وضعیت به `REFUNDED` تغییر می‌یابد

---

## 📌 وضعیت‌های ممکن تراکنش‌ها:

* `0 = PENDING`   ⟶ در انتظار تأیید
* `1 = COMPLETED` ⟶ پرداخت کامل شده
* `2 = REFUNDED`  ⟶ وجه بازگردانده شده

---

**این ABI برای اتصال آسان قرارداد اسکرو به DAO، اپلیکیشن تلگرامی و تست‌های خودکار در شبکه TON طراحی شده است.**
