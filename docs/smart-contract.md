# 📜 مستندات قرارداد هوشمند پروژه کامیاب 

## مقدمه

در این سند، جزئیات پیاده‌سازی قراردادهای هوشمند پروژه "کامیاب" بر بستر شبکه بلاکچین TON شرح داده می‌شود. دو قرارداد اصلی در این پروژه تعریف شده‌اند:

1. قرارداد توکن: `KamyabTokenTON`
2. قرارداد پرداخت امن (Escrow): `EscrowPaymentTON`

---

## قرارداد توکن: KamyabTokenTON

### وظایف اصلی:

* ایجاد توکن KYT با استاندارد سازگار با TON
* تخصیص اولیه به مالک قرارداد
* پشتیبانی از انتقال توکن، تولید (mint) و سوزاندن (burn)

### توابع کلیدی:

* `constructor()` – تخصیص کل توکن‌ها به مالک
* `transfer(address to, uint128 amount)` – انتقال توکن از فرستنده به گیرنده
* `getBalance(address walletAddress)` – دریافت موجودی هر آدرس
* `mint(uint128 amount)` – تولید توکن جدید (فقط توسط مالک)
* `burn(uint128 amount)` – سوزاندن توکن‌های موجود (فقط توسط مالک)

### رویدادها:

* `Transfer` – رویداد ثبت انتقال توکن‌ها

### امنیت:

* استفاده از `modifier onlyOwner` برای محدودسازی توابع حساس به مالک
* بررسی موجودی قبل از هر انتقال

---

## قرارداد اسکرو: EscrowPaymentTON

### وظایف اصلی:

* ایجاد یک تراکنش امن بین صاحب بار و راننده
* نگهداری وجه تا زمان تأیید تحویل کالا
* کسر خودکار کارمزد پلتفرم

### ساختار داده‌ها:

* `Transaction` شامل فرستنده، گیرنده، مبلغ و وضعیت
* `enum Status` شامل: `AWAITING_PAYMENT`, `AWAITING_DELIVERY`, `COMPLETE`, `REFUNDED`

### توابع کلیدی:

* `initiateTransaction(address receiver, uint128 amount)`

  * انتقال مبلغ به قرارداد اسکرو
  * ایجاد تراکنش جدید
* `confirmDelivery(uint256 transactionId)`

  * تأیید تحویل توسط فرستنده
  * آزادسازی وجه به گیرنده و انتقال کارمزد
* `refundTransaction(uint256 transactionId)`

  * بازگشت وجه به فرستنده در صورت بروز مشکل (فقط توسط مالک)

### رویدادها:

* `TransactionInitiated`
* `TransactionCompleted`
* `TransactionRefunded`

---

## سیستم کارمزد

* کارمزد پلتفرم به‌صورت ۵٪ از مبلغ هر تراکنش محاسبه شده و به حساب مالک پروژه منتقل می‌شود.
* این درصد در متغیر `platformFeePercent` ذخیره شده و در صورت نیاز قابل تنظیم در نسخه‌های بعدی قرارداد است.

---

## ارتباط با DApp تلگرام

* کاربران (راننده و صاحب بار) از طریق رابط کاربری تلگرام، فرم‌های پرداخت و تأیید را کامل می‌کنند.
* این ارتباط از طریق TON Connect و Wallet انجام می‌شود.
* هر مرحله در DApp معادل فراخوانی یکی از توابع قرارداد هوشمند خواهد بود.

---

## یادداشت برای توسعه‌دهندگان

* این قراردادها در زبان Solidity برای شبکه TON نوشته شده‌اند و باید با نسخه‌سازگار با کامپایلر `pragma ton-solidity >= 0.43.0` کامپایل شوند.
* در نسخه‌های بعدی، می‌توان مکانیزم‌های اضافی مانند Collateral رانندگان یا چند مرحله‌ای‌کردن پرداخت را به قرارداد اسکرو افزود.

---

**برای مشاهده کد کامل قرارداد، به فایل‌های Solidity در پوشه `/contracts` مراجعه کنید.**
